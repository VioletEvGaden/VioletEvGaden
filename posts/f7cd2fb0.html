<!DOCTYPE html>

<html lang="en">

<head>
    
    <title>SSM学习第四天 - 清濑灰二-箱根山岳险天下！</title>
    <meta charset="UTF-8">
    <meta name="description" content="">
    <meta name="keywords" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5">
    
    

    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
    <meta name="description" content="Spring的aop原理和声明式事务">
<meta property="og:type" content="article">
<meta property="og:title" content="SSM学习第四天">
<meta property="og:url" content="http://violetevgaden.github.io/posts/f7cd2fb0.html">
<meta property="og:site_name" content="清濑灰二-箱根山岳险天下！">
<meta property="og:description" content="Spring的aop原理和声明式事务">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://gitee.com/huzhang-youren/imgupload/raw/master/blogimg/image-20210713114302752.png">
<meta property="article:published_time" content="2021-07-16T12:46:25.000Z">
<meta property="article:modified_time" content="2021-07-31T12:04:16.138Z">
<meta property="article:author" content="VioletEverGarden">
<meta property="article:tag" content="Spring">
<meta property="article:tag" content="Java">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://gitee.com/huzhang-youren/imgupload/raw/master/blogimg/image-20210713114302752.png">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/combine/npm/highlight.js@9.15.8/styles/atom-one-dark.css,npm/justifiedGallery@3.8.1/dist/css/justifiedGallery.min.css,gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css,npm/hexo-theme-nexmoe@latest/source/lib/mdui_043tiny/css/mdui.css,npm/hexo-theme-nexmoe@latest/source/lib/iconfont/iconfont.css?v=233" crossorigin>
    <link rel="stylesheet" href="/css/style.css?v=1634107178910">
    
    <link rel="stylesheet" href="/lib/iconfont/iconfont.css?v=1634107178910">
<meta name="generator" content="Hexo 5.4.0"></head>

<body class="mdui-drawer-body-left">
    
    <div id="nexmoe-background">
        <div class="nexmoe-bg" style="background-image: url(https://gitee.com/huzhang-youren/imgupload/raw/master/blog/1627612859777.jpg)"></div>
        <div class="mdui-appbar mdui-shadow-0">
            <div class="mdui-toolbar">
                <a mdui-drawer="{target: '#drawer', swipe: true}" title="menu" class="mdui-btn mdui-btn-icon mdui-ripple"><i class="mdui-icon nexmoefont icon-menu"></i></a>
                <div class="mdui-toolbar-spacer"></div>
                <!--<a href="javascript:;" class="mdui-btn mdui-btn-icon"><i class="mdui-icon material-icons">search</i></a>-->
                <a href="/" title="VioletEverGarden" class="mdui-btn mdui-btn-icon"><img src="https://gitee.com/huzhang-youren/imgupload/raw/master/blog/20190709021813_vxmcr.jpg" alt="VioletEverGarden"></a>
            </div>
        </div>
    </div>
    <div id="nexmoe-header">
        <div class="nexmoe-drawer mdui-drawer" id="drawer">
    <div class="nexmoe-avatar mdui-ripple">
        <a href="/" title="VioletEverGarden">
            <img src="https://gitee.com/huzhang-youren/imgupload/raw/master/blog/20190709021813_vxmcr.jpg" alt="VioletEverGarden" alt="VioletEverGarden">
        </a>
    </div>
    <div class="nexmoe-count">
         <div class="nexmoe-count-item"><span>文章</span>14 <div class="item-radius"></div><div class="item-radius item-right"></div> </div>
        <div class="nexmoe-count-item"><span>标签</span>9<div class="item-radius"></div><div class="item-radius item-right"></div></div>
        <div class="nexmoe-count-item"><span>分类</span>1<div class="item-radius"></div><div class="item-radius item-right"></div></div>
    </div>
    <div class="nexmoe-list mdui-list" mdui-collapse="{accordion: true}">
        
        <a class="nexmoe-list-item mdui-list-item mdui-ripple false" href="/" title="回到首页">
            <i class="mdui-list-item-icon nexmoefont icon-home"></i>
            <div class="mdui-list-item-content">
                回到首页
            </div>
        </a>
        
        <a class="nexmoe-list-item mdui-list-item mdui-ripple false" href="/archive.html" title="文章归档">
            <i class="mdui-list-item-icon nexmoefont icon-container"></i>
            <div class="mdui-list-item-content">
                文章归档
            </div>
        </a>
        
        <a class="nexmoe-list-item mdui-list-item mdui-ripple false" href="/about.html" title="关于博客">
            <i class="mdui-list-item-icon nexmoefont icon-info-circle"></i>
            <div class="mdui-list-item-content">
                关于博客
            </div>
        </a>
        
        <a class="nexmoe-list-item mdui-list-item mdui-ripple false" href="/PY.html" title="我的朋友">
            <i class="mdui-list-item-icon nexmoefont icon-unorderedlist"></i>
            <div class="mdui-list-item-content">
                我的朋友
            </div>
        </a>
        
    </div>
    <aside id="nexmoe-sidebar">
    
    <div class="nexmoe-widget-wrap">
    <div class="nexmoe-widget nexmoe-search">
         
            <form id="search_form" action_e="https://cn.bing.com/search?q=site:nexmoe.com" onsubmit="return search();">
                <label><input id="search_value" name="q" type="search" placeholder="Search"></label>
            </form>
         
    </div>
</div>
    
    <div class="nexmoe-widget-wrap">
    <div class="nexmoe-widget nexmoe-social">
        <a class="mdui-ripple" href="http://wpa.qq.com/msgrd?v=3&uin=1066771757&site=qq&menu=yes" target="_blank" mdui-tooltip="{content: 'QQ'}" style="color: rgb(249, 174, 8);background-color: rgba(249, 174, 8, .1);">
            <i class="nexmoefont icon-QQ"></i>
        </a><a class="mdui-ripple" href="https://space.bilibili.com/353826360" target="_blank" mdui-tooltip="{content: '哔哩哔哩'}" style="color: rgb(231, 106, 141);background-color: rgba(231, 106, 141, .15);">
            <i class="nexmoefont icon-bilibili"></i>
        </a><a class="mdui-ripple" href="https://github.com/VioletEvGaden" target="_blank" mdui-tooltip="{content: 'GitHub'}" style="color: rgb(25, 23, 23);background-color: rgba(25, 23, 23, .15);">
            <i class="nexmoefont icon-github"></i>
        </a><a class="mdui-ripple" href="https://steamcommunity.com/profiles/76561198966949779/" target="_blank" mdui-tooltip="{content: 'steam'}" style="color: rgb(14,71,161);background-color: rgba(14,71,161,.1);">
            <i class="nexmoefont icon-steam"></i>
        </a>
    </div>
</div>
    
    
  <div class="nexmoe-widget-wrap">
    <div id="randomtagcloud" class="nexmoe-widget tagcloud nexmoe-rainbow">
      <a href="/tags/Java/" style="font-size: 20px;">Java</a> <a href="/tags/Mybatis/" style="font-size: 15px;">Mybatis</a> <a href="/tags/Mybatis-Plus/" style="font-size: 10px;">Mybatis-Plus</a> <a href="/tags/Nosql/" style="font-size: 10px;">Nosql</a> <a href="/tags/Redis/" style="font-size: 10px;">Redis</a> <a href="/tags/Spring/" style="font-size: 17.5px;">Spring</a> <a href="/tags/SpringBoot/" style="font-size: 12.5px;">SpringBoot</a> <a href="/tags/spring-security/" style="font-size: 12.5px;">spring security</a> <a href="/tags/swagger/" style="font-size: 10px;">swagger</a>
    </div>
    
  </div>

    
    
  <div class="nexmoe-widget-wrap">
    <h3 class="nexmoe-widget-title">Categories</h3>
    <div class="nexmoe-widget">

      <ul class="category-list">

        


        

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/后端/">后端</a>
          <span class="category-list-count">14</span>
        </li>

        
      </ul>

    </div>
  </div>


    
</aside>
    <div class="nexmoe-copyright">
        &copy; 2021 VioletEverGarden
        Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
        & <a href="https://github.com/VioletEvGaden" target="_blank">VioletEverGarden</a><br/>
        
        <div style="font-size: 12px">
            <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
            本站总访问量  <a id="busuanzi_value_site_pv"></a> 次<br />
            本站访客数<a id="busuanzi_value_site_uv"></a>人次
        </div>
        
        
    </div>

</div><!-- .nexmoe-drawer -->

    </div>
    <div id="nexmoe-content">
        <div class="nexmoe-primary">
            <div class="nexmoe-post">

  <article>
      
          <div class="nexmoe-post-cover" style="padding-bottom: 41.66666666666667%;"> 
              <img data-src="https://gitee.com/huzhang-youren/imgupload/raw/master/blog/1623340496912.jpeg" data-sizes="auto" alt="SSM学习第四天" class="lazyload">
              <h1>SSM学习第四天</h1>
          </div>
      
      
      <div class="nexmoe-post-meta nexmoe-rainbow" style="margin:10px 0!important;">
    <a><i class="nexmoefont icon-calendar-fill"></i>2021年07月16日</a>
    <a><i class="nexmoefont icon-areachart"></i>3.8k 字</a>
    <a><i class="nexmoefont icon-time-circle-fill"></i>大概 18 分钟</a>
</div>

      

      <p>Spring的aop原理和声明式事务</p>
<span id="more"></span>

<h2 id="一、Spring-的-AOP-简介"><a href="#一、Spring-的-AOP-简介" class="headerlink" title="一、Spring 的 AOP 简介"></a>一、<strong>Spring</strong> <strong>的</strong> <strong>AOP</strong> 简介</h2><h3 id="1-1、-什么是-AOP"><a href="#1-1、-什么是-AOP" class="headerlink" title="1.1、 什么是 AOP"></a><strong>1.1</strong>、 <strong>什么是</strong> <strong>AOP</strong></h3><p><strong>AOP</strong> 为 <strong>A</strong>spect <strong>O</strong>riented <strong>P</strong>rogramming 的缩写，意思为面向切面编程，是通过预编译方式和运行期动态代理实现程序功能的统一维护的一种技术。</p>
<p>AOP 是 OOP 的延续，是软件开发中的一个热点，也是Spring框架中的一个重要内容，是函数式编程的一种衍生范型。利用AOP可以对业务逻辑的各个部分进行隔离，从而使得业务逻辑各部分之间的耦合度降低，提高程序的可重用性，同时提高了开发的效率。</p>
<h3 id="1-2-、AOP-的作用及其优势"><a href="#1-2-、AOP-的作用及其优势" class="headerlink" title="1.2 、AOP 的作用及其优势"></a><strong>1.2 、AOP</strong> <strong>的作用及其优势</strong></h3><ul>
<li><p>作用：在程序运行期间，在不修改源码的情况下对方法进行功能增强</p>
</li>
<li><p>优势：减少重复代码，提高开发效率，并且便于维护</p>
</li>
</ul>
<h3 id="1-3、-AOP-的底层实现"><a href="#1-3、-AOP-的底层实现" class="headerlink" title="1.3、 AOP 的底层实现"></a><strong>1.3、 AOP</strong> <strong>的底层实现</strong></h3><p>实际上，AOP 的底层是通过 Spring 提供的的动态代理技术实现的。在运行期间，Spring通过动态代理技术动态的生成代理对象，代理对象方法执行时进行增强功能的介入，在去调用目标对象的方法，从而完成功能的增强。</p>
<h3 id="1-4-、AOP-的动态代理技术"><a href="#1-4-、AOP-的动态代理技术" class="headerlink" title="1.4 、AOP 的动态代理技术"></a><strong>1.4 、AOP</strong> <strong>的动态代理技术</strong></h3><p>常用的动态代理技术</p>
<ul>
<li><p>JDK 代理 : 基于接口的动态代理技术</p>
</li>
<li><p>cglib 代理：基于父类的动态代理技术</p>
</li>
</ul>
<p><img data-fancybox="gallery" data-sizes="auto" data-src="https://gitee.com/huzhang-youren/imgupload/raw/master/blogimg/image-20210713114302752.png" alt="image-20210713114302752" class="lazyload"></p>
<h3 id="1-5-、JDK-的动态代理"><a href="#1-5-、JDK-的动态代理" class="headerlink" title="1.5 、JDK 的动态代理"></a><strong>1.5 、JDK</strong> <strong>的动态代理</strong></h3><p>①目标类接口</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">TargetInterface</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">method</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>②目标类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Target</span> <span class="keyword">implements</span> <span class="title">TargetInterface</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">method</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Target running....&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>③动态代理代码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">Target target = <span class="keyword">new</span> Target(); <span class="comment">//创建目标对象</span></span><br><span class="line"><span class="comment">//创建代理对象</span></span><br><span class="line">TargetInterface proxy = (TargetInterface) Proxy.newProxyInstance(target.getClass()</span><br><span class="line">.getClassLoader(),target.getClass().getInterfaces(),<span class="keyword">new</span> InvocationHandler() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">invoke</span><span class="params">(Object proxy, Method method, Object[] args)</span> </span></span><br><span class="line"><span class="function">            <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;前置增强代码...&quot;</span>);</span><br><span class="line">        Object invoke = method.invoke(target, args);</span><br><span class="line">        System.out.println(<span class="string">&quot;后置增强代码...&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> invoke;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">);</span><br><span class="line"><span class="comment">//调用代理对象的方法测试</span></span><br><span class="line"><span class="comment">// 测试,当调用接口的任何方法时，代理对象的代码都无序修改</span></span><br><span class="line">proxy.method();</span><br></pre></td></tr></table></figure>

<h3 id="1-6-、cglib-的动态代理"><a href="#1-6-、cglib-的动态代理" class="headerlink" title="1.6 、cglib 的动态代理"></a><strong>1.6</strong> 、<strong>cglib</strong> <strong>的动态代理</strong></h3><p>①目标类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Target</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">method</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Target running....&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>②动态代理代码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">Target target = <span class="keyword">new</span> Target(); <span class="comment">//创建目标对象</span></span><br><span class="line">Enhancer enhancer = <span class="keyword">new</span> Enhancer();   <span class="comment">//创建增强器</span></span><br><span class="line">enhancer.setSuperclass(Target.class); <span class="comment">//设置父类</span></span><br><span class="line">enhancer.setCallback(<span class="keyword">new</span> MethodInterceptor() &#123; <span class="comment">//设置回调</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">intercept</span><span class="params">(Object o, Method method, Object[] objects, </span></span></span><br><span class="line"><span class="params"><span class="function">    MethodProxy methodProxy)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;前置代码增强....&quot;</span>);</span><br><span class="line">        Object invoke = method.invoke(target, objects);</span><br><span class="line">        System.out.println(<span class="string">&quot;后置代码增强....&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> invoke;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line">Target proxy = (Target) enhancer.create(); <span class="comment">//创建代理对象</span></span><br><span class="line"><span class="comment">//测试,当调用接口的任何方法时，代理对象的代码都无序修改</span></span><br><span class="line">proxy.method();</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="1-7-、AOP-相关概念"><a href="#1-7-、AOP-相关概念" class="headerlink" title="1.7 、AOP 相关概念"></a><strong>1.7 、AOP</strong> <strong>相关概念</strong></h3><p>Spring 的 AOP 实现底层就是对上面的动态代理的代码进行了封装，封装后我们只需要对需要关注的部分进行代码编写，并通过配置的方式完成指定目标的方法增强。</p>
<p>在正式讲解 AOP 的操作之前，我们必须理解 AOP 的相关术语，常用的术语如下:</p>
<ul>
<li><p>Target（目标对象）：代理的目标对象</p>
</li>
<li><p>Proxy （代理）：一个类被 AOP 织入增强后，就产生一个结果代理类</p>
</li>
<li><p>Joinpoint（连接点）：所谓连接点是指那些被拦截到的点。在spring中,这些点指的是方法，因为spring只支持方法类型的连接点</p>
</li>
<li><p> Pointcut（切入点）：所谓切入点是指我们要对哪些 Joinpoint 进行拦截的定义</p>
</li>
<li><p> Advice（通知/ 增强）：所谓通知是指拦截到 Joinpoint 之后所要做的事情就是通知</p>
</li>
<li><p> Aspect（切面）：是切入点和通知（引介）的结合</p>
</li>
<li><p> Weaving（织入）：是指把增强应用到目标对象来创建新的代理对象的过程。spring采用动态代理织入，而AspectJ采用编译期织入和类装载期织入</p>
</li>
</ul>
<h3 id="1-8-、AOP-开发明确的事项"><a href="#1-8-、AOP-开发明确的事项" class="headerlink" title="1.8 、AOP 开发明确的事项"></a><strong>1.8 、AOP</strong> <strong>开发明确的事项</strong></h3><p>1**.** <strong>需要编写的内容</strong></p>
<ul>
<li><p>编写核心业务代码（目标类的目标方法）</p>
</li>
<li><p>编写切面类，切面类中有通知(增强功能方法)</p>
</li>
<li><p>在配置文件中，配置织入关系，即将哪些通知与哪些连接点进行结合</p>
</li>
</ul>
<p><strong>2. AOP</strong> <strong>技术实现的内容</strong></p>
<p>Spring 框架监控切入点方法的执行。一旦监控到切入点方法被运行，使用代理机制，动态创建目标对象的代理对象，根据通知类别，在代理对象的对应位置，将通知对应的功能织入，完成完整的代码逻辑运行。</p>
<p><strong>3. AOP</strong> <strong>底层使用哪种代理方式</strong></p>
<p>在 spring 中，框架会根据目标类是否实现了接口来决定采用哪种动态代理的方式。</p>
<h2 id="二、基于-XML-的-AOP-开发"><a href="#二、基于-XML-的-AOP-开发" class="headerlink" title="二、基于 XML 的 AOP 开发"></a>二、<strong>基于</strong> <strong>XML</strong> <strong>的</strong> <strong>AOP</strong> <strong>开发</strong></h2><h3 id="2-1、-快速入门"><a href="#2-1、-快速入门" class="headerlink" title="2.1、 快速入门"></a><strong>2.1</strong>、 <strong>快速入门</strong></h3><p>①导入 AOP 相关坐标</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--导入spring的context坐标，context依赖aop--&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-context&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;<span class="number">5.0</span><span class="number">.5</span>.RELEASE&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">    &lt;!-- aspectj的织入 --&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.aspectj&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;aspectjweaver&lt;/artifactId&gt;<span class="comment">//其中aop更全面</span></span><br><span class="line">    &lt;version&gt;<span class="number">1.8</span><span class="number">.13</span>&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>



<p>②创建目标接口和目标类（内部有切点）</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">TargetInterface</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">method</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Target</span> <span class="keyword">implements</span> <span class="title">TargetInterface</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">method</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Target running....&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>③创建切面类（内部有增强方法）</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyAspect</span> </span>&#123;</span><br><span class="line">    <span class="comment">//前置增强方法</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">before</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;前置代码增强.....&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>④将目标类和切面类的对象创建权交给 spring</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--配置目标类--&gt;</span><br><span class="line">    &lt;bean id=<span class="string">&quot;target&quot;</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;com.itheima.aop.Target&quot;</span>&gt;&lt;/bean&gt;</span><br><span class="line">&lt;!--配置切面类--&gt;</span><br><span class="line">    &lt;bean id=<span class="string">&quot;myAspect&quot;</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;com.itheima.aop.MyAspect&quot;</span>&gt;&lt;/bean&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>⑤在 applicationContext.xml 中配置织入关系</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;aop:config&gt;</span><br><span class="line">    &lt;!--引用myAspect的Bean为切面对象--&gt;</span><br><span class="line">    &lt;aop:aspect ref=<span class="string">&quot;myAspect&quot;</span>&gt;</span><br><span class="line">        &lt;!--配置Target的method方法执行时要进行myAspect的before方法前置增强--&gt;</span><br><span class="line">        &lt;aop:before method=<span class="string">&quot;before&quot;</span> pointcut=<span class="string">&quot;execution(public void com.itheima.aop.Target.method())&quot;</span>&gt;&lt;/aop:before&gt;</span><br><span class="line">    &lt;/aop:aspect&gt;</span><br><span class="line">&lt;/aop:config&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>⑥测试代码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RunWith(SpringJUnit4ClassRunner.class)</span></span><br><span class="line"><span class="meta">@ContextConfiguration(&quot;classpath:applicationContext.xml&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AopTest</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> TargetInterface target;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test1</span><span class="params">()</span></span>&#123;</span><br><span class="line">        target.method();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="2-2、-XML-配置-AOP-详解"><a href="#2-2、-XML-配置-AOP-详解" class="headerlink" title="2.2、 XML 配置 AOP 详解"></a><strong>2.2、 XML</strong> <strong>配置</strong> <strong>AOP</strong> <strong>详解</strong></h3><p><strong>1.</strong> <strong>切点表达式的写法</strong></p>
<p>表达式语法：</p>
<p>​    execution([修饰符] 返回值类型 包名.类名.方法名(参数))</p>
<ul>
<li><p>访问修饰符可以省略</p>
</li>
<li><p>返回值类型、包名、类名、方法名可以使用星号* 代表任意</p>
</li>
<li><p>包名与类名之间一个点 . 代表当前包下的类，两个点 .. 表示当前包及其子包下的类</p>
</li>
<li><p>参数列表可以使用两个点 .. 表示任意个数，任意类型的参数列表</p>
</li>
</ul>
<p>例如：</p>
<p>​    execution(public void com.itheima.aop.Target.method()) </p>
<p>​    execution(void com.itheima.aop.Target.*(..))</p>
<p>​    execution(* com.itheima.aop.<em>.</em>(..))</p>
<p>​    execution(* com.itheima.aop..<em>.</em>(..))</p>
<p>​    execution(* <em>..</em>.*(..))</p>
<p><strong>2.</strong> <strong>通知的类型</strong></p>
<p>通知的配置语法：</p>
<p>&lt;aop:通知类型 method=“切面类中方法名” pointcut=“切点表达式”&gt;&lt;/aop:通知类型&gt;</p>
<table>
<thead>
<tr>
<th><strong>名称</strong></th>
<th><strong>标签</strong></th>
<th><strong>说明</strong></th>
</tr>
</thead>
<tbody><tr>
<td>前置通知</td>
<td><a href="aop:before">aop:before</a></td>
<td>用于配置前置通知。指定增强的方法在切入点方法之前执行</td>
</tr>
<tr>
<td>后置通知</td>
<td><a href="aop:after-returning">aop:after-returning</a></td>
<td>用于配置后置通知。指定增强的方法在切入点方法之后执行</td>
</tr>
<tr>
<td>环绕通知</td>
<td><a href="aop:around">aop:around</a></td>
<td>用于配置环绕通知。指定增强的方法在切入点方法之前和之后都执行</td>
</tr>
<tr>
<td>异常抛出通知</td>
<td><a href="aop:throwing">aop:throwing</a></td>
<td>用于配置异常抛出通知。指定增强的方法在出现异常时执行</td>
</tr>
<tr>
<td>最终通知</td>
<td><a href="aop:after">aop:after</a></td>
<td>用于配置最终通知。无论增强方式执行是否有异常都会执行</td>
</tr>
</tbody></table>
<p>环绕通知演示</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Object <span class="title">around</span><span class="params">(ProceedingJoinPoint pjp)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;环绕前增强....&quot;</span>);</span><br><span class="line">        Object proceed = pjp.proceed();<span class="comment">//切点方法</span></span><br><span class="line">        System.out.println(<span class="string">&quot;环绕后增强....&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> proceed;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>3**.** <strong>切点表达式的抽取</strong></p>
<p>当多个增强的切点表达式相同时，可以将切点表达式进行抽取，在增强中使用 pointcut-ref 属性代替 pointcut 属性来引用抽取后的切点表达式。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;aop:config&gt;</span><br><span class="line">    &lt;!--引用myAspect的Bean为切面对象--&gt;</span><br><span class="line">    &lt;aop:aspect ref=<span class="string">&quot;myAspect&quot;</span>&gt;</span><br><span class="line">        &lt;aop:pointcut id=<span class="string">&quot;myPointcut&quot;</span> expression=<span class="string">&quot;execution(* com.itheima.aop.*.*(..))&quot;</span>/&gt;</span><br><span class="line">     	&lt;aop:before method=<span class="string">&quot;before&quot;</span> pointcut-ref=<span class="string">&quot;myPointcut&quot;</span>&gt;&lt;/aop:before&gt;</span><br><span class="line">     &lt;/aop:aspect&gt;</span><br><span class="line">&lt;/aop:config&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="三、基于注解的-AOP-开发"><a href="#三、基于注解的-AOP-开发" class="headerlink" title="三、基于注解的 AOP 开发"></a>三、基于注解的 <strong>AOP</strong> <strong>开发</strong></h2><h3 id="3-1、-代码演示"><a href="#3-1、-代码演示" class="headerlink" title="3.1、 代码演示"></a><strong>3.1</strong>、 代码演示</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component(&quot;myAspect&quot;)</span></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyAspect</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Before(&quot;execution(* com.itheima.aop.*.*(..))&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">before</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;前置代码增强.....&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在配置文件中开启组件扫描和 AOP 的自动代理</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--组件扫描--&gt;</span><br><span class="line">    &lt;context:component-scan base-<span class="keyword">package</span>=<span class="string">&quot;com.itheima.aop&quot;</span>/&gt;</span><br><span class="line">&lt;!--aop的自动代理--&gt;</span><br><span class="line">    &lt;aop:aspectj-autoproxy&gt;&lt;/aop:aspectj-autoproxy&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="3-2-注解配置-AOP-详解"><a href="#3-2-注解配置-AOP-详解" class="headerlink" title="3.2 注解配置 AOP 详解"></a><strong>3.2</strong> <strong>注解配置</strong> <strong>AOP</strong> <strong>详解</strong></h3><p>1**.** <strong>注解通知的类型</strong></p>
<p>通知的配置语法：@通知注解(“切点表达式”)</p>
<table>
<thead>
<tr>
<th><strong>名称</strong></th>
<th><strong>注解</strong></th>
<th><strong>说明</strong></th>
</tr>
</thead>
<tbody><tr>
<td>前置通知</td>
<td>@Before</td>
<td>用于配置前置通知。指定增强的方法在切入点方法之前执行</td>
</tr>
<tr>
<td>后置通知</td>
<td>@AfterReturning</td>
<td>用于配置后置通知。指定增强的方法在切入点方法之后执行</td>
</tr>
<tr>
<td>环绕通知</td>
<td>@Around</td>
<td>用于配置环绕通知。指定增强的方法在切入点方法之前和之后都执行</td>
</tr>
<tr>
<td>异常抛出通知</td>
<td>@AfterThrowing</td>
<td>用于配置异常抛出通知。指定增强的方法在出现异常时执行</td>
</tr>
<tr>
<td>最终通知</td>
<td>@After</td>
<td>用于配置最终通知。无论增强方式执行是否有异常都会执行</td>
</tr>
</tbody></table>
<p><strong>2.</strong> <strong>切点表达式的抽取</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">@<span class="meta">@Component(&quot;myAspect&quot;)</span></span><br><span class="line"><span class="meta">@Aspect</span><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyAspect</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Before(&quot;MyAspect.myPoint()&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">before</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;前置代码增强.....&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Pointcut(&quot;execution(* com.itheima.aop.*.*(..))&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">myPoint</span><span class="params">()</span></span>&#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="四、声明式事务控制"><a href="#四、声明式事务控制" class="headerlink" title="四、声明式事务控制"></a>四、声明式事务控制</h2><h3 id="4-1、编程式事务控制相关对象"><a href="#4-1、编程式事务控制相关对象" class="headerlink" title="4.1、编程式事务控制相关对象"></a>4.1、<strong>编程式事务控制相关对象</strong></h3><h4 id="1-1-PlatformTransactionManager"><a href="#1-1-PlatformTransactionManager" class="headerlink" title="1.1 PlatformTransactionManager"></a><strong>1.1</strong> <strong>PlatformTransactionManager</strong></h4><p>PlatformTransactionManager 接口是 spring 的事务管理器，它里面提供了我们常用的操作事务的方法。</p>
<table>
<thead>
<tr>
<th><strong>方法</strong></th>
<th><strong>说明</strong></th>
</tr>
</thead>
<tbody><tr>
<td>TransactionStatus  getTransaction(TransactionDefination  defination)</td>
<td>获取事务的状态信息</td>
</tr>
<tr>
<td>void  commit(TransactionStatus status)</td>
<td>提交事务</td>
</tr>
<tr>
<td>void  rollback(TransactionStatus status)</td>
<td>回滚事务</td>
</tr>
</tbody></table>
<p><strong>注意：</strong></p>
<p>PlatformTransactionManager 是接口类型，不同的 Dao 层技术则有不同的实现类，例如：Dao 层技术是jdbc 或 mybatis 时：org.springframework.jdbc.datasource.DataSourceTransactionManager</p>
<p>Dao 层技术是hibernate时：org.springframework.orm.hibernate5.HibernateTransactionManager</p>
<h4 id="1-2-TransactionDefinition"><a href="#1-2-TransactionDefinition" class="headerlink" title="1.2 TransactionDefinition"></a><strong>1.2</strong> <strong>TransactionDefinition</strong></h4><p>TransactionDefinition 是事务的定义信息对象，里面有如下方法：</p>
<table>
<thead>
<tr>
<th><strong>方法</strong></th>
<th><strong>说明</strong></th>
</tr>
</thead>
<tbody><tr>
<td>int  getIsolationLevel()</td>
<td>获得事务的隔离级别</td>
</tr>
<tr>
<td>int  getPropogationBehavior()</td>
<td>获得事务的传播行为</td>
</tr>
<tr>
<td>int  getTimeout()</td>
<td>获得超时时间</td>
</tr>
<tr>
<td>boolean  isReadOnly()</td>
<td>是否只读</td>
</tr>
</tbody></table>
<p><strong>1.事务隔离级别</strong></p>
<p>设置隔离级别，可以解决事务并发产生的问题，如脏读、不可重复读和虚读。</p>
<ul>
<li><p>ISOLATION_DEFAULT  //默认为可重复读</p>
</li>
<li><p>ISOLATION_READ_UNCOMMITTED  //读未提交，脏读</p>
</li>
<li><p> ISOLATION_READ_COMMITTED   //导致不可重复读</p>
</li>
<li><p>ISOLATION_REPEATABLE_READ  //解决了脏读和不可重复读的问题，但是会产生幻读</p>
</li>
<li><p>ISOLATION_SERIALIZABLE     //串行化 串行化读，事务只能一个一个执行，避免了 脏读、不可重复读、幻读。执行效率慢，使用时慎重</p>
</li>
</ul>
<p><strong>2.</strong> <strong>事务传播行为</strong></p>
<ul>
<li><p>REQUIRED：如果当前没有事务，就新建一个事务，如果已经存在一个事务中，加入到这个事务中。一般的选择（默认值）</p>
</li>
<li><p>SUPPORTS：支持当前事务，如果当前没有事务，就以非事务方式执行（没有事务）</p>
</li>
<li><p>MANDATORY：使用当前的事务，如果当前没有事务，就抛出异常</p>
</li>
<li><p>REQUERS_NEW：新建事务，如果当前在事务中，把当前事务挂起。</p>
</li>
<li><p>NOT_SUPPORTED：以非事务方式执行操作，如果当前存在事务，就把当前事务挂起</p>
</li>
<li><p>NEVER：以非事务方式运行，如果当前存在事务，抛出异常</p>
</li>
<li><p>NESTED：如果当前存在事务，则在嵌套事务内执行。如果当前没有事务，则执行 REQUIRED 类似的操作</p>
</li>
<li><p>超时时间：默认值是-1，没有超时限制。如果有，以秒为单位进行设置</p>
</li>
<li><p>是否只读：建议查询时设置为只读</p>
</li>
</ul>
<h4 id="1-3-TransactionStatus"><a href="#1-3-TransactionStatus" class="headerlink" title="1.3 TransactionStatus"></a><strong>1.3</strong> <strong>TransactionStatus</strong></h4><p>TransactionStatus 接口提供的是事务具体的运行状态，方法介绍如下。</p>
<table>
<thead>
<tr>
<th><strong>方法</strong></th>
<th><strong>说明</strong></th>
</tr>
</thead>
<tbody><tr>
<td>boolean  hasSavepoint()</td>
<td>是否存储回滚点</td>
</tr>
<tr>
<td>boolean  isCompleted()</td>
<td>事务是否完成</td>
</tr>
<tr>
<td>boolean  isNewTransaction()</td>
<td>是否是新事务</td>
</tr>
<tr>
<td>boolean  isRollbackOnly()</td>
<td>事务是否回滚</td>
</tr>
</tbody></table>
<h3 id="4-2、基于-XML-的声明式事务控制"><a href="#4-2、基于-XML-的声明式事务控制" class="headerlink" title="4.2、基于 XML 的声明式事务控制"></a>4.2、<strong>基于</strong> <strong>XML</strong> <strong>的声明式事务控制</strong></h3><h4 id="1-1、什么是声明式事务控制"><a href="#1-1、什么是声明式事务控制" class="headerlink" title="1.1、什么是声明式事务控制"></a>1.1、<strong>什么是声明式事务控制</strong></h4><p>Spring 的声明式事务顾名思义就是采用声明的方式来处理事务。这里所说的声明，就是指在配置文件中声明，用在 Spring 配置文件中声明式的处理事务来代替代码式的处理事务。</p>
<p><strong>声明式事务处理的作用</strong></p>
<ul>
<li><p>事务管理不侵入开发的组件。具体来说，业务逻辑对象就不会意识到正在事务管理之中，事实上也应该如此，因为事务管理是属于系统层面的服务，而不是业务逻辑的一部分，如果想要改变事务管理策划的话，也只需要在定义文件中重新配置即可</p>
</li>
<li><p> 在不需要事务管理的时候，只要在设定文件上修改一下，即可移去事务管理服务，无需改变代码重新编译，这样维护起来极其方便</p>
</li>
</ul>
<p><strong>注意</strong>：Spring 声明式事务控制底层就是AOP。</p>
<h4 id="1-2-声明式事务控制的实现"><a href="#1-2-声明式事务控制的实现" class="headerlink" title="1.2 声明式事务控制的实现"></a><strong>1.2</strong> <strong>声明式事务控制的实现</strong></h4><p>①引入tx命名空间</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;beans xmlns=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span>       xmlns:xsi=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>       xmlns:context=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span>       xmlns:aop=<span class="string">&quot;http://www.springframework.org/schema/aop&quot;</span>       xmlns:tx=<span class="string">&quot;http://www.springframework.org/schema/tx&quot;</span>       xsi:schemaLocation=<span class="string">&quot;        http://www.springframework.org/schema/context        http://www.springframework.org/schema/context/spring-context.xsd        http://www.springframework.org/schema/aop        http://www.springframework.org/schema/aop/spring-aop.xsd        http://www.springframework.org/schema/tx         http://www.springframework.org/schema/tx/spring-tx.xsd        http://www.springframework.org/schema/beans        http://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span>&gt;</span><br></pre></td></tr></table></figure>

<p>②配置事务增强</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--平台事务管理器--&gt;</span><br><span class="line">    &lt;bean id=<span class="string">&quot;transactionManager&quot;</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;org.springframework.jdbc.datasource.DataSourceTransactionManager&quot;</span>&gt;</span><br><span class="line">        &lt;property name=<span class="string">&quot;dataSource&quot;</span> ref=<span class="string">&quot;dataSource&quot;</span>&gt;&lt;/property&gt;</span><br><span class="line">    &lt;/bean&gt;</span><br><span class="line">&lt;!--事务增强配置--&gt;</span><br><span class="line">        &lt;tx:advice id=<span class="string">&quot;txAdvice&quot;</span> transaction-manager=<span class="string">&quot;transactionManager&quot;</span>&gt;</span><br><span class="line">            &lt;tx:attributes&gt;</span><br><span class="line">                &lt;tx:method name=<span class="string">&quot;*&quot;</span>/&gt;</span><br><span class="line">            &lt;/tx:attributes&gt;</span><br><span class="line">        &lt;/tx:advice&gt;</span><br></pre></td></tr></table></figure>

<p>③配置事务 AOP 织入</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;aop:config&gt;</span><br><span class="line">        &lt;aop:pointcut id=<span class="string">&quot;txPointcut&quot;</span> expression=<span class="string">&quot;execution(* com.itheima.service.impl.*.*(..))&quot;</span>/&gt;</span><br><span class="line">        &lt;aop:advisor advice-ref=<span class="string">&quot;txAdvice&quot;</span> pointcut-ref=<span class="string">&quot;txPointcut&quot;</span>/&gt;</span><br><span class="line">    &lt;/aop:config&gt;</span><br></pre></td></tr></table></figure>

<p>④测试事务控制转账业务代码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">transfer</span><span class="params">(String outMan, String inMan, <span class="keyword">double</span> money)</span> </span>&#123;</span><br><span class="line">    accountDao.out(outMan,money);</span><br><span class="line">    <span class="keyword">int</span> i = <span class="number">1</span>/<span class="number">0</span>;</span><br><span class="line">    accountDao.in(inMan,money);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="4-3、基于注解的声明式事务控制"><a href="#4-3、基于注解的声明式事务控制" class="headerlink" title="4.3、基于注解的声明式事务控制"></a>4.3、<strong>基于注解的声明式事务控制</strong></h3><ol>
<li><p>编写 AccoutDao</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Repository(&quot;accountDao&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AccountDaoImpl</span> <span class="keyword">implements</span> <span class="title">AccountDao</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> JdbcTemplate jdbcTemplate;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">out</span><span class="params">(String outMan, <span class="keyword">double</span> money)</span> </span>&#123;</span><br><span class="line">        jdbcTemplate.update(<span class="string">&quot;update account set money=money-? where name=?&quot;</span>,money,outMan);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">in</span><span class="params">(String inMan, <span class="keyword">double</span> money)</span> </span>&#123;</span><br><span class="line">        jdbcTemplate.update(<span class="string">&quot;update account set money=money+? where name=?&quot;</span>,money,inMan);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>编写AccountService</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">@Service(&quot;accountService&quot;)</span><br><span class="line">@Transactional</span><br><span class="line">public class AccountServiceImpl implements AccountService &#123;</span><br><span class="line">@Autowired</span><br><span class="line">private AccountDao accountDao;</span><br><span class="line">@Transactional(isolation = Isolation.READ_COMMITTED,propagation = Propagation.REQUIRED)</span><br><span class="line">public void transfer(String outMan, String inMan, double money) &#123;</span><br><span class="line">accountDao.out(outMan,money);</span><br><span class="line">int i = 1/0;</span><br><span class="line">accountDao.in(inMan,money);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><p>编写 applicationContext.xml 配置文件</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;!—之前省略datsSource、jdbcTemplate、平台事务管理器的配置--&gt;</span><br><span class="line">&lt;!--组件扫描--&gt;</span><br><span class="line">    &lt;context:component-scan base-<span class="keyword">package</span>=<span class="string">&quot;com.itheima&quot;</span>/&gt;</span><br><span class="line">&lt;!--事务的注解驱动--&gt;</span><br><span class="line">&lt;tx:annotation-driven/&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>

  </article>

  
      
    <div class="nexmoe-post-copyright">
        <strong>Author：</strong>VioletEverGarden<br>
        <strong>Link：</strong><a href="http://violetevgaden.github.io/posts/f7cd2fb0.html" title="http:&#x2F;&#x2F;violetevgaden.github.io&#x2F;posts&#x2F;f7cd2fb0.html" target="_blank" rel="noopener">http:&#x2F;&#x2F;violetevgaden.github.io&#x2F;posts&#x2F;f7cd2fb0.html</a><br>
        
            <strong>版权声明：</strong>本文采用 <a href="https://creativecommons.org/licenses/by-nc-sa/3.0/cn/deed.zh" target="_blank">CC BY-NC-SA 3.0 CN</a> 协议进行许可
        
    </div>


  
  
  <div class="nexmoe-post-meta nexmoe-rainbow">
    
        <a class="nexmoefont icon-appstore-fill -link" href="/categories/%E5%90%8E%E7%AB%AF/">后端</a>
    
    
        <a class="nexmoefont icon-tag-fill -none-link" href="/tags/Java/" rel="tag">Java</a> <a class="nexmoefont icon-tag-fill -none-link" href="/tags/Spring/" rel="tag">Spring</a>
    
</div>

  
      <div class="nexmoe-post-footer">
          <section class="nexmoe-comment">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@latest/dist/gitalk.min.css">
<div id="gitalk"></div>
<script src="https://cdn.jsdelivr.net/npm/gitalk@latest/dist/gitalk.min.js"></script>
<script type="text/javascript">
    var gitalk = new Gitalk({
        clientID: '9c68004b717aa2fca18d',
        clientSecret: '37806f775f54e65c1e1712bbc3bdd474f4016759',
        id: window.location.pathname,
        repo: 'VioletEvGaden.github.io',
        owner: 'VioletEvGaden',
        admin: 'VioletEvGaden'
    })
    gitalk.render('gitalk')
</script>
</section>
      </div>
  
</div>
            <div class="nexmoe-post-right">
              <div class="nexmoe-fixed">
                  <div class="nexmoe-tool"> 
                    
                      
                        
                          
                          
                              <button class="mdui-fab catalog" style="overflow:unset;">
                                  <i class="nexmoefont icon-i-catalog"></i>
                                  <div class="nexmoe-toc">
                                      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80%E3%80%81Spring-%E7%9A%84-AOP-%E7%AE%80%E4%BB%8B"><span class="toc-number">1.</span> <span class="toc-text">一、Spring 的 AOP 简介</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-1%E3%80%81-%E4%BB%80%E4%B9%88%E6%98%AF-AOP"><span class="toc-number">1.1.</span> <span class="toc-text">1.1、 什么是 AOP</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-%E3%80%81AOP-%E7%9A%84%E4%BD%9C%E7%94%A8%E5%8F%8A%E5%85%B6%E4%BC%98%E5%8A%BF"><span class="toc-number">1.2.</span> <span class="toc-text">1.2 、AOP 的作用及其优势</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-3%E3%80%81-AOP-%E7%9A%84%E5%BA%95%E5%B1%82%E5%AE%9E%E7%8E%B0"><span class="toc-number">1.3.</span> <span class="toc-text">1.3、 AOP 的底层实现</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-4-%E3%80%81AOP-%E7%9A%84%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86%E6%8A%80%E6%9C%AF"><span class="toc-number">1.4.</span> <span class="toc-text">1.4 、AOP 的动态代理技术</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-5-%E3%80%81JDK-%E7%9A%84%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86"><span class="toc-number">1.5.</span> <span class="toc-text">1.5 、JDK 的动态代理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-6-%E3%80%81cglib-%E7%9A%84%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86"><span class="toc-number">1.6.</span> <span class="toc-text">1.6 、cglib 的动态代理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-7-%E3%80%81AOP-%E7%9B%B8%E5%85%B3%E6%A6%82%E5%BF%B5"><span class="toc-number">1.7.</span> <span class="toc-text">1.7 、AOP 相关概念</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-8-%E3%80%81AOP-%E5%BC%80%E5%8F%91%E6%98%8E%E7%A1%AE%E7%9A%84%E4%BA%8B%E9%A1%B9"><span class="toc-number">1.8.</span> <span class="toc-text">1.8 、AOP 开发明确的事项</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8C%E3%80%81%E5%9F%BA%E4%BA%8E-XML-%E7%9A%84-AOP-%E5%BC%80%E5%8F%91"><span class="toc-number">2.</span> <span class="toc-text">二、基于 XML 的 AOP 开发</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1%E3%80%81-%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8"><span class="toc-number">2.1.</span> <span class="toc-text">2.1、 快速入门</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2%E3%80%81-XML-%E9%85%8D%E7%BD%AE-AOP-%E8%AF%A6%E8%A7%A3"><span class="toc-number">2.2.</span> <span class="toc-text">2.2、 XML 配置 AOP 详解</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%89%E3%80%81%E5%9F%BA%E4%BA%8E%E6%B3%A8%E8%A7%A3%E7%9A%84-AOP-%E5%BC%80%E5%8F%91"><span class="toc-number">3.</span> <span class="toc-text">三、基于注解的 AOP 开发</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1%E3%80%81-%E4%BB%A3%E7%A0%81%E6%BC%94%E7%A4%BA"><span class="toc-number">3.1.</span> <span class="toc-text">3.1、 代码演示</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-%E6%B3%A8%E8%A7%A3%E9%85%8D%E7%BD%AE-AOP-%E8%AF%A6%E8%A7%A3"><span class="toc-number">3.2.</span> <span class="toc-text">3.2 注解配置 AOP 详解</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9B%9B%E3%80%81%E5%A3%B0%E6%98%8E%E5%BC%8F%E4%BA%8B%E5%8A%A1%E6%8E%A7%E5%88%B6"><span class="toc-number">4.</span> <span class="toc-text">四、声明式事务控制</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-1%E3%80%81%E7%BC%96%E7%A8%8B%E5%BC%8F%E4%BA%8B%E5%8A%A1%E6%8E%A7%E5%88%B6%E7%9B%B8%E5%85%B3%E5%AF%B9%E8%B1%A1"><span class="toc-number">4.1.</span> <span class="toc-text">4.1、编程式事务控制相关对象</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-1-PlatformTransactionManager"><span class="toc-number">4.1.1.</span> <span class="toc-text">1.1 PlatformTransactionManager</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2-TransactionDefinition"><span class="toc-number">4.1.2.</span> <span class="toc-text">1.2 TransactionDefinition</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-3-TransactionStatus"><span class="toc-number">4.1.3.</span> <span class="toc-text">1.3 TransactionStatus</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2%E3%80%81%E5%9F%BA%E4%BA%8E-XML-%E7%9A%84%E5%A3%B0%E6%98%8E%E5%BC%8F%E4%BA%8B%E5%8A%A1%E6%8E%A7%E5%88%B6"><span class="toc-number">4.2.</span> <span class="toc-text">4.2、基于 XML 的声明式事务控制</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-1%E3%80%81%E4%BB%80%E4%B9%88%E6%98%AF%E5%A3%B0%E6%98%8E%E5%BC%8F%E4%BA%8B%E5%8A%A1%E6%8E%A7%E5%88%B6"><span class="toc-number">4.2.1.</span> <span class="toc-text">1.1、什么是声明式事务控制</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2-%E5%A3%B0%E6%98%8E%E5%BC%8F%E4%BA%8B%E5%8A%A1%E6%8E%A7%E5%88%B6%E7%9A%84%E5%AE%9E%E7%8E%B0"><span class="toc-number">4.2.2.</span> <span class="toc-text">1.2 声明式事务控制的实现</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-3%E3%80%81%E5%9F%BA%E4%BA%8E%E6%B3%A8%E8%A7%A3%E7%9A%84%E5%A3%B0%E6%98%8E%E5%BC%8F%E4%BA%8B%E5%8A%A1%E6%8E%A7%E5%88%B6"><span class="toc-number">4.3.</span> <span class="toc-text">4.3、基于注解的声明式事务控制</span></a></li></ol></li></ol>
                                  </div>
                              </button>
                          
                          
                      
                    
                      <a href="#nexmoe-content" class="toc-link" aria-label="回到顶部" title="top"><button class="mdui-fab mdui-ripple"><i class="nexmoefont icon-caret-top"></i></button></a>
                  </div>
              </div>
            </div>
        </div>
    </div>
    <script src="https://cdn.jsdelivr.net/combine/npm/lazysizes@5.1.0/lazysizes.min.js,npm/mdui@0.4.3/dist/js/mdui.min.js?v=1"></script>
<script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js"></script>

 

<script async src="/js/app.js?v=1634107178935"></script>

<script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/js/jquery.justifiedGallery.min.js"></script>
<script>
	$(".justified-gallery").justifiedGallery({
		rowHeight: 160,
		margins: 10,
	});
</script>


    





</body>

</html>
